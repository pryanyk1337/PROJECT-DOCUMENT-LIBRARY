# CONSTRAINTS_REGISTRY.md

## НАЗНАЧЕНИЕ

Централизованный реестр всех ограничений, запретов и граничных условий для AI-агентов. Определяет, что агенты НЕ ДОЛЖНЫ делать, и устанавливает границы допустимого поведения.

---

## РАЗДЕЛ 1: КЛАССИФИКАЦИЯ ОГРАНИЧЕНИЙ

### 1.1 Уровни критичности

| Уровень | Название | Последствие нарушения |
|---------|----------|----------------------|
| **L0** | БЛОКИРУЮЩИЙ | Агент не проходит валидацию, результат отклоняется |
| **L1** | КРИТИЧНЫЙ | Требуется немедленное исправление |
| **L2** | ВАЖНЫЙ | Требуется исправление до релиза |
| **L3** | РЕКОМЕНДАТЕЛЬНЫЙ | Желательно исправить, не блокирует |

### 1.2 Категории ограничений

| Категория | Описание | Примеры |
|-----------|----------|---------|
| **COMM** | Коммуникационные | Запрет инструкций для пользователя |
| **CONTENT** | Контентные | Запрет черновиков |
| **FORMAT** | Форматные | Требования к структуре |
| **RESOURCE** | Ресурсные | Токен-дисциплина |
| **SAFETY** | Безопасность | Этические ограничения |
| **LOGIC** | Логические | Запрет противоречий |

---

## РАЗДЕЛ 2: РЕЕСТР ОГРАНИЧЕНИЙ

### 2.1 Блокирующие ограничения (L0)

| ID | Категория | Ограничение | Проверка |
|----|-----------|-------------|----------|
| **L0-COMM-001** | COMM | Запрещены инструкции для пользователя | Поиск фраз: "скопируйте", "передайте", "сделайте" |
| **L0-CONTENT-001** | CONTENT | Запрещены черновики и наброски | Поиск слов: "черновой", "предварительный", "набросок" |
| **L0-CONTENT-002** | CONTENT | Запрещены незавершённые артефакты | Проверка: последний элемент завершён |
| **L0-FORMAT-001** | FORMAT | JSON должен быть валидным | JSON.parse() без ошибок |
| **L0-SAFETY-001** | SAFETY | Запрещён вредоносный контент | Фильтр опасных инструкций |

### 2.2 Критичные ограничения (L1)

| ID | Категория | Ограничение | Проверка |
|----|-----------|-------------|----------|
| **L1-COMM-001** | COMM | Агент не рассуждает от лица других агентов | Нет фраз: "агент X сначала сделает..." |
| **L1-CONTENT-001** | CONTENT | Фаза интервью обязательна | Наличие блока interview_phase |
| **L1-FORMAT-001** | FORMAT | Блок [ЗАВЕРШЕНИЕ] обязателен | Наличие секции с чек-листом |
| **L1-LOGIC-001** | LOGIC | Нет конфликтующих принципов профилей | Проверка по матрице совместимости |
| **L1-RESOURCE-001** | RESOURCE | Нет повторов из предыдущего контекста | Сравнение с историей чата |

### 2.3 Важные ограничения (L2)

| ID | Категория | Ограничение | Проверка |
|----|-----------|-------------|----------|
| **L2-CONTENT-001** | CONTENT | Обоснования ≤ 2 предложения на агента | Подсчёт предложений |
| **L2-FORMAT-001** | FORMAT | Ссылки вместо цитат на справочники | Поиск длинных цитат |
| **L2-RESOURCE-001** | RESOURCE | Token Efficiency ≥ 70% | Расчёт метрики |
| **L2-RESOURCE-002** | RESOURCE | Длина ответа в рамках режима | Подсчёт слов |

### 2.4 Рекомендательные ограничения (L3)

| ID | Категория | Ограничение | Проверка |
|----|-----------|-------------|----------|
| **L3-CONTENT-001** | CONTENT | Примеры применения в каждом разделе | Наличие примеров |
| **L3-FORMAT-001** | FORMAT | Использование таблиц для структурированных данных | Наличие таблиц |
| **L3-COMM-001** | COMM | Тон системный, протокольный | Стилистический анализ |

---

## РАЗДЕЛ 3: ГРАНИЧНЫЕ УСЛОВИЯ

### 3.1 Лимиты по режимам работы

| Режим | Макс. слов | Макс. агентов в цепочке | Макс. итераций |
|-------|------------|-------------------------|----------------|
| Режим 1 | 500 | 3 | 1 |
| Режим 2 | 900 | 5 | 2 |
| Режим 3 | 1500 | 7 | 3 |

### 3.2 Лимиты по типам артефактов

| Артефакт | Минимум | Максимум | Примечание |
|----------|---------|----------|------------|
| Концепции (К) | 3 | 7 | Принцип множественности |
| Этапы roadmap (Б) | 3 | 10 | Декомпозиция |
| Проверки (Т) | 5 | 20 | Верификация |
| Примеры | 1 | 3 | На раздел |

### 3.3 Лимиты на циклы и итерации

```
Максимум итераций самопроверки: 3
Максимум уточняющих вопросов: 5
Максимум циклов "создание → проверка": 3
Максимум глубина вложенности структуры: 4 уровня
```

---

## РАЗДЕЛ 4: ТОКЕН-ДИСЦИПЛИНА

### 4.1 Приоритеты сокращения

При превышении лимита слов — сокращать в порядке:

```
1. Вводные пояснения (ПЕРВЫМИ)
2. Примеры (если > 2)
3. Альтернативные сценарии
4. Обоснования (до 1 предложения)
5. Таблицы — НЕ СОКРАЩАТЬ
6. Чек-листы — НЕ СОКРАЩАТЬ
7. Блок [ЗАВЕРШЕНИЕ] — НЕ СОКРАЩАТЬ (НИКОГДА)
```

### 4.2 Формулы расчёта

**Доля пояснений:**
```
Explanation_Ratio = (слова_пояснений / всего_слов) × 100
Порог: ≤ 30%
```

**Эффективность ссылок:**
```
Reference_Efficiency = (ссылки / (ссылки + цитаты)) × 100
Порог: ≥ 90%
```

### 4.3 Запрещённые паттерны (анти-примеры)

| Паттерн | Пример | Почему запрещено |
|---------|--------|------------------|
| Избыточное введение | "Прежде чем начать, важно понимать, что..." | Трата токенов |
| Пересказ контекста | "Как вы указали в предыдущем сообщении..." | Дублирование |
| Обсуждение выбора | "Я рассматривал два варианта и выбрал..." | Процесс не нужен |
| Цитирование справочников | "Согласно файлу X, принцип Y гласит..." | Ссылка вместо цитаты |

---

## РАЗДЕЛ 5: ДОПУСКИ И ИСКЛЮЧЕНИЯ

### 5.1 Условные допуски

| Ограничение | Условие допуска | Пример |
|-------------|-----------------|--------|
| Лимит слов | Режим 3 + сложная задача | +20% к лимиту |
| Фаза интервью | Задача 100% определена | Пропуск интервью |
| Множественность К | Запрос "один вариант" | 1 вместо 3-5 |

### 5.2 Процедура получения допуска

```
1. Идентифицировать ограничение
2. Проверить наличие условия допуска
3. Если условие выполнено — применить допуск
4. Зафиксировать в блоке [САМОПРОВЕРКА]: "Применён допуск: [ID]"
```

---

## РАЗДЕЛ 6: FALLBACK-СТРАТЕГИИ

### 6.1 Стратегии при проблемах

| Проблема | Fallback-стратегия |
|----------|-------------------|
| Не хватает данных | Фаза интервью → явные предположения |
| Превышен лимит слов | Сокращение по приоритетам |
| Несовместимые агенты | Добавить агента-адаптер |
| Цикличная зависимость | Лимит 3 итерации → выбор лучшего |
| Источник недоступен | Альтернативный источник + пометка |

### 6.2 Эскалация проблем

```
Уровень 1: Автономное решение агентом
    ↓ (если не решено)
Уровень 2: Запрос уточнения через интервью
    ↓ (если не решено)
Уровень 3: Явное предположение + пометка риска
    ↓ (если критично)
Уровень 4: Отказ от выполнения с объяснением
```

---

## РАЗДЕЛ 7: ЧЕК-ЛИСТ ПРОВЕРКИ ОГРАНИЧЕНИЙ

### 7.1 Быстрая проверка (L0)

```
[ ] Нет инструкций для пользователя (L0-COMM-001)
[ ] Нет слов "черновой", "набросок" (L0-CONTENT-001)
[ ] Артефакт завершён (L0-CONTENT-002)
[ ] JSON валиден (L0-FORMAT-001)
[ ] Контент безопасен (L0-SAFETY-001)

Результат: Все ✓ → продолжить | Любой ✗ → СТОП
```

### 7.2 Полная проверка (L0-L2)

```
БЛОКИРУЮЩИЕ (L0):
[ ] L0-COMM-001: Нет инструкций для пользователя
[ ] L0-CONTENT-001: Нет черновиков
[ ] L0-CONTENT-002: Артефакт завершён
[ ] L0-FORMAT-001: JSON валиден
[ ] L0-SAFETY-001: Контент безопасен

КРИТИЧНЫЕ (L1):
[ ] L1-COMM-001: Нет рассуждений от лица агентов
[ ] L1-CONTENT-001: Фаза интервью есть
[ ] L1-FORMAT-001: Блок [ЗАВЕРШЕНИЕ] есть
[ ] L1-LOGIC-001: Нет конфликтов профилей
[ ] L1-RESOURCE-001: Нет повторов из контекста

ВАЖНЫЕ (L2):
[ ] L2-CONTENT-001: Обоснования ≤ 2 предложения
[ ] L2-FORMAT-001: Ссылки вместо цитат
[ ] L2-RESOURCE-001: Token Efficiency ≥ 70%
[ ] L2-RESOURCE-002: Длина в рамках режима
```

---

## ПРИМЕРЫ ПРИМЕНЕНИЯ

### Пример 1: Обнаружение нарушения L0-COMM-001

```
Текст агента: "После получения результата, скопируйте его в новый документ."

Проверка L0-COMM-001:
- Поиск: "скопируйте" → НАЙДЕНО
- Статус: ❌ НАРУШЕНИЕ

Коррекция:
- Удалить инструкцию для пользователя
- Переформулировать как инструкцию для агента:
  "Результат форматируется как самостоятельный документ."
```

### Пример 2: Применение допуска

```
Ситуация: Пользователь запросил "один лучший вариант названия"

Ограничение: Принцип К "Множественность" (минимум 3 варианта)

Проверка условия допуска:
- Явный запрос пользователя на 1 вариант → ДА

Решение: Применить допуск
- Сгенерировать 1 вариант
- Зафиксировать: "Применён допуск: запрос пользователя на 1 вариант"
```

---

VERSION: 1.0 | DATE: 2026-02-27